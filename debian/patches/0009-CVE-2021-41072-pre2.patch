commit 1993a4e7aeda04962bf26e84c15fba8b58837e10
Author: Phillip Lougher <phillip@squashfs.org.uk>
Date:   Sun Sep 12 20:09:13 2021 +0100

    unsquashfs: dynamically allocate name
    
    Dynamically allocate name rather than store it
    directly in structure.
    
    Signed-off-by: Phillip Lougher <phillip@squashfs.org.uk>

Index: squashfs-tools-4.2+20130409/unsquash-1.c
===================================================================
--- squashfs-tools-4.2+20130409.orig/unsquash-1.c	2021-09-24 11:38:58.736636480 +0200
+++ squashfs-tools-4.2+20130409/unsquash-1.c	2021-09-24 11:38:58.732636480 +0200
@@ -303,7 +303,7 @@
 						"realloc failed!\n");
 				dir->dirs = new_dir;
 			}
-			strcpy(dir->dirs[dir->dir_count].name, dire->name);
+                        dir->dirs[dir->dir_count].name = strdup(dire->name);
 			dir->dirs[dir->dir_count].start_block =
 				dirh.start_block;
 			dir->dirs[dir->dir_count].offset = dire->offset;
Index: squashfs-tools-4.2+20130409/unsquash-1234.c
===================================================================
--- squashfs-tools-4.2+20130409.orig/unsquash-1234.c	2021-09-24 11:38:58.736636480 +0200
+++ squashfs-tools-4.2+20130409/unsquash-1234.c	2021-09-24 11:38:58.732636480 +0200
@@ -60,6 +60,11 @@
 
 void squashfs_closedir(struct dir *dir)
 {
+	int i;
+
+	for(i = 0; i < dir->dir_count; i++)
+		free(dir->dirs[i].name);
+
 	free(dir->dirs);
 	free(dir);
 }
Index: squashfs-tools-4.2+20130409/unsquash-3.c
===================================================================
--- squashfs-tools-4.2+20130409.orig/unsquash-3.c	2021-09-24 11:38:58.736636480 +0200
+++ squashfs-tools-4.2+20130409/unsquash-3.c	2021-09-24 11:38:58.732636480 +0200
@@ -381,7 +381,7 @@
 						"realloc failed!\n");
 				dir->dirs = new_dir;
 			}
-			strcpy(dir->dirs[dir->dir_count].name, dire->name);
+                        dir->dirs[dir->dir_count].name = strdup(dire->name);
 			dir->dirs[dir->dir_count].start_block =
 				dirh.start_block;
 			dir->dirs[dir->dir_count].offset = dire->offset;
Index: squashfs-tools-4.2+20130409/unsquash-4.c
===================================================================
--- squashfs-tools-4.2+20130409.orig/unsquash-4.c	2021-09-24 11:38:58.736636480 +0200
+++ squashfs-tools-4.2+20130409/unsquash-4.c	2021-09-24 11:38:58.732636480 +0200
@@ -340,7 +340,7 @@
 						"realloc failed!\n");
 				dir->dirs = new_dir;
 			}
-			strcpy(dir->dirs[dir->dir_count].name, dire->name);
+                        dir->dirs[dir->dir_count].name = strdup(dire->name);
 			dir->dirs[dir->dir_count].start_block =
 				dirh.start_block;
 			dir->dirs[dir->dir_count].offset = dire->offset;
Index: squashfs-tools-4.2+20130409/unsquashfs.h
===================================================================
--- squashfs-tools-4.2+20130409.orig/unsquashfs.h	2021-09-24 11:38:58.736636480 +0200
+++ squashfs-tools-4.2+20130409/unsquashfs.h	2021-09-24 11:38:58.732636480 +0200
@@ -165,7 +165,7 @@
 #define DIR_ENT_SIZE	16
 
 struct dir_ent	{
-	char		name[SQUASHFS_NAME_LEN + 1];
+	char		*name;
 	unsigned int	start_block;
 	unsigned int	offset;
 	unsigned int	type;
