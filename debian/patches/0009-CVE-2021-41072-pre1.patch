commit 80b8441a37fcf8bf07dacf24d9d6c6459a0f6e36
Author: Phillip Lougher <phillip@squashfs.org.uk>
Date:   Sun Sep 12 19:58:19 2021 +0100

    unsquashfs: use squashfs_closedir() to delete directory
    
    Signed-off-by: Phillip Lougher <phillip@squashfs.org.uk>

Index: squashfs-tools-4.2+20130409/unsquash-1.c
===================================================================
--- squashfs-tools-4.2+20130409.orig/unsquash-1.c	2021-09-24 11:38:13.764639628 +0200
+++ squashfs-tools-4.2+20130409/unsquash-1.c	2021-09-24 11:38:13.764639628 +0200
@@ -316,8 +316,7 @@
 	return dir;
 
 corrupted:
-	free(dir->dirs);
-	free(dir);
+	squashfs_closedir(dir);
 	return NULL;
 }
 
Index: squashfs-tools-4.2+20130409/unsquash-1234.c
===================================================================
--- squashfs-tools-4.2+20130409.orig/unsquash-1234.c	2021-09-24 11:38:13.764639628 +0200
+++ squashfs-tools-4.2+20130409/unsquash-1234.c	2021-09-24 11:38:13.764639628 +0200
@@ -25,8 +25,8 @@
  * unsquash-4.
  */
 
-#define TRUE 1
-#define FALSE 0
+#include "unsquashfs.h"
+
 /*
  * Check name for validity, name should not
  *  - be ".", "./", or
@@ -56,3 +56,10 @@
 
 	return TRUE;
 }
+
+
+void squashfs_closedir(struct dir *dir)
+{
+	free(dir->dirs);
+	free(dir);
+}
Index: squashfs-tools-4.2+20130409/unsquash-3.c
===================================================================
--- squashfs-tools-4.2+20130409.orig/unsquash-3.c	2021-09-24 11:38:13.764639628 +0200
+++ squashfs-tools-4.2+20130409/unsquash-3.c	2021-09-24 11:38:13.764639628 +0200
@@ -394,7 +394,6 @@
 	return dir;
 
 corrupted:
-	free(dir->dirs);
-	free(dir);
+	squashfs_closedir(dir);
 	return NULL;
 }
Index: squashfs-tools-4.2+20130409/unsquash-4.c
===================================================================
--- squashfs-tools-4.2+20130409.orig/unsquash-4.c	2021-09-24 11:38:13.764639628 +0200
+++ squashfs-tools-4.2+20130409/unsquash-4.c	2021-09-24 11:38:13.764639628 +0200
@@ -353,8 +353,7 @@
 	return dir;
 
 corrupted:
-	free(dir->dirs);
-	free(dir);
+	squashfs_closedir(dir);
 	return NULL;
 }
 
Index: squashfs-tools-4.2+20130409/unsquashfs.c
===================================================================
--- squashfs-tools-4.2+20130409.orig/unsquashfs.c	2021-09-24 11:38:13.764639628 +0200
+++ squashfs-tools-4.2+20130409/unsquashfs.c	2021-09-24 11:38:13.764639628 +0200
@@ -1208,13 +1208,6 @@
 }
 
 
-void squashfs_closedir(struct dir *dir)
-{
-	free(dir->dirs);
-	free(dir);
-}
-
-
 char *get_component(char *target, char **targname)
 {
 	char *start;
Index: squashfs-tools-4.2+20130409/unsquashfs.h
===================================================================
--- squashfs-tools-4.2+20130409.orig/unsquashfs.h	2021-09-24 11:38:13.764639628 +0200
+++ squashfs-tools-4.2+20130409/unsquashfs.h	2021-09-24 11:38:46.264637367 +0200
@@ -269,3 +269,4 @@
 
 /* unsquash-1234.c */
 extern int check_name(char *, int);
+extern void squashfs_closedir(struct dir *);
